<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل دخول الطالب | FCAI</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="login-body">

    <div class="login-box">
        <h2 style="color: var(--primary-color); margin-bottom: 20px;">بوابة الطالب</h2>
        <form id="loginForm">
            <div class="input-group">
                <label>البريد الجامعي</label>
                <input type="email" id="email" placeholder="student@fcai.edu.eg" required>
            </div>
            <div class="input-group">
                <label>كلمة المرور</label>
                <input type="password" id="password" placeholder="********" required>
            </div>
            <button type="submit" class="submit-btn">دخول</button>
        </form>
        <p style="margin-top: 15px; font-size: 0.8rem; color: #64748b;">
            <a href="index.html" style="color: var(--primary-color);">العودة للرئيسية</a>
        </p>
    </div>

    <div id="alertModal" class="custom-modal">
        <div class="modal-content">
            <h3 id="modalTitle">تنبيه</h3>
            <p id="modalMessage">رسالة التنبيه هنا</p>
            <button class="modal-btn" onclick="closeModal()">حسناً</button>
        </div>
    </div>

    <script>
        // --- نظام الاتصال بقاعدة البيانات ---
        const DB_KEY = 'fcai_students_db';

        // دالة عرض النافذة المنبثقة بدلاً من الـ alert العادي
        function showModal(title, message, isSuccess = false) {
            const modal = document.getElementById('alertModal');
            const titleElem = document.getElementById('modalTitle');
            const msgElem = document.getElementById('modalMessage');
            
            titleElem.innerText = title;
            msgElem.innerText = message;
            
            // تغيير لون العنوان حسب الحالة (نجاح أو خطأ)
            if (isSuccess) {
                titleElem.style.color = '#22c55e'; // أخضر للنجاح
            } else {
                titleElem.style.color = '#ef4444'; // أحمر للخطأ
            }

            modal.style.display = 'flex'; // إظهار النافذة
        }

        // إغلاق النافذة
        function closeModal() {
            document.getElementById('alertModal').style.display = 'none';
        }

        // جلب البيانات
        function getStudentsDB() {
            const data = localStorage.getItem(DB_KEY);
            if (!data) {
                // بيانات احتياطية في حالة الطوارئ فقط
                const fallbackData = [
                    { id: "252196", email: "252196@fcai.edu.eg", password: "fcai123", fullName: "أحمد محمد محمود علي", level: "المستوى الأول", gpa: "3.4", dept: "General" }
                ];
                localStorage.setItem(DB_KEY, JSON.stringify(fallbackData));
                return fallbackData;
            }
            return JSON.parse(data);
        }

        // منطق تسجيل الدخول
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const emailInput = document.getElementById('email').value.trim();
            const passwordInput = document.getElementById('password').value.trim();
            
            const studentsList = getStudentsDB();

            const foundStudent = studentsList.find(student => 
                student.email === emailInput && student.password === passwordInput
            );

            if (foundStudent) {
                // حالة النجاح
                localStorage.setItem('currentUser', JSON.stringify(foundStudent));
                
                // استخدام النافذة الجديدة
                showModal('تم بنجاح', 'مرحباً بك! جاري تحويلك للوحة التحكم...', true);
                
                // الانتظار ثانية ونصف ليرى المستخدم الرسالة ثم التحويل
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);

            } else {
                // حالة الفشل (تم تعديل الرسالة لتكون آمنة)
                showModal('خطأ في الدخول', 'البريد الإلكتروني أو كلمة المرور غير صحيحة. يرجى المحاولة مرة أخرى.');
            }
        });
    </script>
</body>
</html>
